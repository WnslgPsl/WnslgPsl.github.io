---
layout: post
title: 회사코드에 MVP패턴 대표님 몰래 도입하기3
date: 2018-07-23 13:44:20 +0300
description:
img: google-mvp-sample-img.png
tags: [Android, Kotlin, MVP]
---
<br>
사실 Model이라고 불려지는 곳은 특별한게 아닙니다. (물론 제 주관적인 생각입니다.)</br>
뷰를 제외한 대부분의 일들을 처리 하는 곳이죠 음 음.. 음?
</br>

차근차근 들어가보면 Presenter에서 Model에 일을 시키려면 무언가를 실행 해야하는데</br>
이때 Repository가 등장하게 되죠

## Repository 등장
```kotlin
class MainRepository : MainDataSource{

    private val remoteDataSource by lazy {
        RemoteDataSource()
    }

    override fun getSearchPhotos(format: String, nojsoncallback: String, method: String,
                                 searchKeyword: String, flickrKey: String, requestPage: Int,
                                 requestPerPage: Int, callback: MainDataSource.LoadFlickrCallback) {

        remoteDataSource.getSearchPhotos(format, nojsoncallback, method, searchKeyword, flickrKey, requestPage, requestPerPage,
                object : MainDataSource.LoadFlickrCallback {

                    override fun onSuccess(t: PhotoResponse) {
                        callback.onSuccess(t)
                    }

                    override fun onFailure(message: String) {
                        callback.onFailure(message)
                    }
                })
    }
}
```

MainDataSource 인터페이스의 getSearchPhotos 메소드를 구현하고 있습니다. 필요한 인자값을 받으면서 콜백을 만들기 위해 LoadFlickrCallback를 받고 있습니다.

MainDataSource는 구현하고자 하는 기능들을 정의만 해둔 인터페이스 입니다.

```kotlin
interface MainDataSource {


    interface LoadFlickrCallback {
        fun onSuccess(t: PhotoResponse)
        fun onFailure(message: String)
    }

    fun getSearchPhotos(format: String, nojsoncallback: String, method: String, searchKeyword: String, flickrKey: String, requestPage: Int,
                                 requestPerPage: Int, callback: LoadFlickrCallback)
}
```
물론 LoadFlickrCallback 콜백 인터페이스를 편의상 같이 두긴했지만 따로 구현하셔도 상관없겠죠ㅎㅎ</br>
여기서 getSearchPhotos라던지 getUser 라던지 필요한 기능들과 필요한 파라메터 값들을 미리 정의해두고  Repository에서 구현하게 강제? 하고 있습니다. </br>
</br>

위 MainRepository클래스 소스를 보시면 RemoteDataSource 라는 클래스가 보입니다. Repository에서 받은 인자값들과 코틀린 object 키워드를 이용하여 LoadFlickrCallback 익명 클래스를 인자로 메소드를 호출 하고 있습니다. </br>
</br>

클래스 이름에서 보듯이 Repository는 어디서 오는 데이터 인지를 구분지어 호출 할 수 있습니다. 예를들어 sqlite, realm 등 로컬에서 데이터를 가져오게 된다면 LocalDataSource라는 클래스를 만들어서 값을 처리해 주면 되겠죠 ㅎㅎ</br>
</br>

## 서버로부터 값을 받는 RemoteDataSource클래스
```kotlin
class RemoteDataSource : MainDataSource{
    
    override fun getSearchPhotos(format: String, nojsoncallback: String, method: String, searchKeyword: String,
                                 flickrKey: String, requestPage: Int, requestPerPage: Int,
                                 callback: MainDataSource.LoadFlickrCallback) {

        val call = createRetrofit().getFlickrSearch(format, nojsoncallback,
                method, flickrKey, searchKeyword, requestPage, requestPerPage)

        val networkManager = NetworkManager(call)
        networkManager.setOnStartNetworkListener(object : NetworkCallbackListener<PhotoResponse> {

            override fun onResponse(photoResponse: PhotoResponse){
                callback.onSuccess(photoResponse)
            }

            override fun onFailure(msg: String) {
                callback.onFailure(msg)
            }
        })
    }
}
```
RemoteDataSource 클래스도 마찬가지로 MainDataSource의 메소드를 구현하여 서버로부터 값을 받아오는 처리를 하고 있습니다. 받아온 값은 익명클래스로 전달받은 LoadFlickrCallback을 이용하여 Repository에 값을 전달해 주고 있네요.
